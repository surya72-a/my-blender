import bpy


class HelloWorldPanel(bpy.types.Panel):
    """Creates a Panel in the Object properties window"""
    bl_label = "Hello World Panel"
    bl_idname = "OBJECT_PT_hello"
    bl_space_type = 'VIEW_3D'
    bl_region_type = 'UI'
    bl_category = "New"

    def draw(self, context):
        layout = self.layout
        row = layout.row()
        row.operator("shader.neon_operator")  


class SHADER_OT_NEON(bpy.types.Operator):
    """Operator to add a neon shader"""
    bl_label = "Add Neon Shader"
    bl_idname = "shader.neon_operator"

    def execute(self, context):
        
        
        cur_frame = bpy.context.scene.frame_current
        
        obj = context.object
        if obj is None or obj.type != 'MESH':
            self.report({'WARNING'}, "Select a mesh object first!")
            return {'CANCELLED'}

        
        material_name = "NeonMaterial"
        material = bpy.data.materials.get(material_name) or bpy.data.materials.new(name=material_name)
        material.use_nodes = True
        
        
        tree = material_neon.node_tree
        
        
        nodes = material.node_tree.nodes
        links = material.node_tree.links

       
        for node in nodes:
            nodes.remove(node)

        
        emission = nodes.new(type='ShaderNodeEmission')
        emission.location = (0, 300)
        emission.inputs[0].default_value = (0.3, 0.7, 1, 1)  
        emission.inputs[1].default_value = 15  
        emission.inputs[1].keyframe_insert("default_value", frame = cur_frame)
        
        
        
        
        
        
        
        

        
        output = nodes.new(type='ShaderNodeOutputMaterial')
        output.location = (300, 300)

        
        links.new(emission.outputs['Emission'], output.inputs['Surface'])

      
        if obj.data.materials:
            obj.data.materials[0] = material 
        else:
            obj.data.materials.append(material) 

       
        scene = bpy.context.scene
        if scene.render.engine == 'BLENDER_EEVEE':
            scene.eevee.use_bloom = True 

       
        for area in bpy.context.screen.areas:
            if area.type == 'VIEW_3D':
                for space in area.spaces:
                    if space.type == 'VIEW_3D':
                        space.shading.type = 'RENDERED'

        return {'FINISHED'}


def register():
    bpy.utils.register_class(HelloWorldPanel)
    bpy.utils.register_class(SHADER_OT_NEON) 


def unregister():
    bpy.utils.unregister_class(HelloWorldPanel)
    bpy.utils.unregister_class(SHADER_OT_NEON)  


if __name__ == "__main__":
    register()
